/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={913:e=>{function t(e){return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&!e.isContentEditable)}e.exports=class{constructor(e){this.apiKey=e.apiKey||"REVERIE_API_KEY",this.appId=e.appId||"REVERIE_APP_ID",this.baseUrl=e.baseUrl||"https://revapi.reverieinc.com/",this.isListening=!1;let t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/reverie-stt-sdk/dist/bundle.js",document.body.appendChild(t)}async transliterate({text:e,src_lang:t,tgt_lang:r,domain:a=1}){try{if(!t)throw new Error("Source language is required");if(!r)throw new Error("Target language is required");if(!e)throw new Error("Text to transliterate is required");let n=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,src_lang:t,tgt_lang:r,domain:a,cnt_lang:"en","REV-APPNAME":"transliteration"},body:JSON.stringify({data:[e],isBulk:!1,ignoreTaggedEntities:!1})});if(n=await n.json(),n&&n.responseList&&n.responseList.length>0)return n.responseList[0].outString[0];throw new Error("Failed to transliterate text")}catch(e){return e.message}}async analyze_text({text:e,src_lang:t,tgt_lang:r,translation_domain:a,moderation_types:n}){try{if(!t)throw new Error("Content language is required");if(!e)throw new Error("Text is required for text analysis");const i=`${this.baseUrl}api/v2/text-analyse?translate=true&summary=true&sentiment=false&detect_entities=true&content_safety=true&pii_redaction=true`,o={"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"text-analysis"},s={text:e,language:t,pii_redaction:{redact_pii_sub:"entity_name",redact_pii_types:[]},summary:{summary_model:"gemma2:2b",summary_type:"gist"},entity_recognition:{entity_types:[]},sentiment:{level:"whole"},content_moderation:{moderation_types:n||["hate_speech","profanity"]}};r&&(s.traslation={target_language:r,translation_domain:a||"generic"});let l=await fetch(i,{method:"POST",headers:o,body:JSON.stringify(s)});if(l=await l.json(),l&&l.results)return l.results;throw new Error("Failed to analyze text")}catch(e){return e.message}}async identify_language_by_text({text:e}){try{if(!e)throw new Error("Text to identify is required");if(e.length>512)throw new Error("Text exceeds maximum length of 512 characters");let t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"lang_id_text"},body:JSON.stringify({text:e,max_length:Math.pow(2,Math.floor(Math.sqrt(e.length))+1)})});if(t=await t.json(),t)return t;throw new Error("Failed to detect text")}catch(e){return e.message}}async translate({text:e,src_lang:t,tgt_lang:r,domain:a}){try{if(!t)throw new Error("Source language is required");if(!r)throw new Error("Target language is required");if(!e)throw new Error("Text to translate is required");let n=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,src_lang:t,tgt_lang:r,domain:a||"generic","REV-APPNAME":"localization","REV-APPVERSION":"3.0"},body:JSON.stringify({data:[e],nmtMask:!0,nmtMaskTerms:{},enableNmt:!0,enableLookup:!0})});if(n=await n.json(),n&&n.responseList&&n.responseList.length>0)return n.responseList[0].outString;throw new Error("Failed to translate text")}catch(e){return e.message}}async stt_batch({audioFile:e,src_lang:t,domain:r}){try{if(!t)throw new Error("Source language is required");if(!e)throw new Error("File to transcribe is required");const a=new FormData;a.append("audio_file",e);let n=await fetch("https://revapi.reverieinc.com/",{method:"POST",headers:{src_lang:t,domain:r||"generic","REV-APPNAME":"stt_file","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId},body:a});if(n=await n.json(),n&&n.display_text)return n.display_text;throw new Error("Failed to transcribe text")}catch(e){return e.message}}async text_to_speech({text:e,speaker:t,speed:r,pitch:a,format:n="WAV"}){try{if(!t)throw new Error("Speaker is required for TTS");if(!e)throw new Error("Text is required for TTS");if(!["WAV","MP3"].includes(n))throw new Error("Invalid audio format. Supported formats are wav and mp3");const i={text:e,speed:parseFloat(r),pitch:parseFloat(a),format:"WAV",speaker:t};let o=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"tts",speaker:t},body:JSON.stringify(i)}),s=await o.blob();if(o)return s;throw new Error("Failed to do tts for the text")}catch(e){return e}}async init_stt({src_lang:e,domain:r,silence:a,continuous:n,logging:i,timeout:o,callback:s,element:l}){if(!e)throw new Error("Source language is required for STT");if(!s&&!l)throw new Error("Callback or element is required for STT");if(s&&"function"!=typeof s)throw new Error("Callback must be a function");if(l&&"object"!=typeof l)throw new Error("Element must be a DOM element");if(r&&"string"!=typeof r)throw new Error("Domain must be a string");if(a&&"number"!=typeof a)throw new Error("Silence must be a number");if(n&&"boolean"!=typeof n)throw new Error("Continuous must be a boolean");if(i&&"boolean"!=typeof i)throw new Error("Logging must be a boolean");if(o&&"number"!=typeof o)throw new Error("Timeout must be a number");try{await window.stt_stream.initSTT({apikey:this.apiKey,appId:this.appId,language:e,domain:r||"generic",silence:a||1,continuous:n||1,logging:!i||!1!==i,timeout:o||180,eventHandler:r=>function(e,r,a,n){let i=e.data;a&&t(a)&&("FINAL_RESULT"===e.event||"PARTIAL_RESULTS"===e.event&&["es-ES","fr-FR","ar-SA"].includes(n))&&document.execCommand("insertText",!1,i),a&&!t(a)||!r||r({stt_event:{...e}})}(r,s,l,e),errorHandler:e=>console.error("Error:",e)}),console.log("STT Streaming initialized successfully")}catch(e){console.error("STT Initialization failed:",e)}}async start_stt(){await window.stt_stream.startSTT(),this.isListening=!0}async stop_stt(){await window.stt_stream.stopSTT(),this.isListening=!1}async toggle_stt(){this.isListening?await this.stop_stt():await this.start_stt()}async translateDocument({sourceLanguage:e,targetLanguage:t,uploadedFile:r}){try{const a=new FormData;a.append("sourceLanguage",e||"english"),a.append("targetLanguage",t||"hindi"),a.append("projectFiles",r);const n=await fetch("https://revapi.reverieinc.com/translate_doc_import",{method:"POST",headers:{"REV-APP-ID":this.appId,"REV-APPNAME":"nmt","REV-API-KEY":this.apiKey},body:a}),i=await n.json();if(n.ok&&i.projectId)return this.checkStatus(i.projectId,t);throw new Error("Error in translation process")}catch(e){throw new Error("Translation failed: "+e.message)}}async checkStatus(e,t){return new Promise(((r,a)=>{const n=async()=>{try{const a=await fetch(`https://revapi.reverieinc.com/translate_doc_status?doc_id=${e}`,{headers:{"REV-APP-ID":this.appId,"REV-APPNAME":"nmt","REV-API-KEY":this.apiKey}}),i=await a.json();i.success&&"completed"===i.message?r(this.downloadTranslatedFile(e,t)):setTimeout(n,2e3)}catch(e){a(new Error("Error checking status: "+e.message))}};n()}))}async downloadTranslatedFile(e,t){try{const r=await fetch("https://revapi.reverieinc.com/translate_doc_export",{method:"POST",headers:{"Content-Type":"application/json","REV-APP-ID":this.appId,"REV-APPNAME":"nmt","REV-API-KEY":this.apiKey},body:JSON.stringify({unitId:e,targetLanguages:[t]})}),a=await r.json();if(a.success)return Object.values(a.data.targetURLS).forEach((e=>{Object.values(e).forEach((e=>{window.open(e,"_blank")}))})),"Translation complete! File is ready for download.";throw new Error("Error downloading translation")}catch(e){throw new Error("Download failed: "+e.message)}}async uploadDocument({file:e,file_type:t,languages:r,ocr_type:a}){try{if(!e)throw new Error("Please select a file");if(!t||"pdf"!==t&&"img"!==t)throw new Error("Invalid file_type. Must be 'pdf' or 'img'");if(!r)throw new Error("Languages parameter is required");if(!a||"layout_ocr"!==a&&"only_ocr"!==a)throw new Error("Invalid ocr_type. Must be 'layout_ocr' or 'only_ocr'");if("img"===t&&"layout_ocr"===a)throw new Error("Layout OCR is not supported for images. Please select Only OCR.");const n=new FormData;n.append("file",e),n.append("file_type",t),n.append("languages",r),n.append("ocr_type",a);let i=await fetch(this.baseUrl+"/process_doc",{method:"POST",headers:{"REV-APP-ID":this.appId,"REV-API-KEY":this.apiKey,"REV-APPNAME":"ocr"},body:n});return"layout_ocr"===a?await i.blob():await i.text()}catch(e){return e.message}}async uploadAudio({file:e}){try{if(!e)throw new Error("Please select an audio file");const t=new FormData;t.append("audio_file",e);let r=await fetch(this.baseUrl+"/upload",{method:"POST",headers:{"REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"slid"},body:t}),a=await r.json();if(!a.success)throw new Error(a.cause);return{transcriptionId:a.id,language:a.language,confidence:a.confidence}}catch(e){throw e}}}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=r(913),n=r.n(a);document.getElementById("uploadBtn").addEventListener("click",(async()=>{const e=new(n())({apiKey:"da1c12acfee8a204cf6a135ec0157d6adaffd478",appId:"com.npmpackage"});console.log("hey",e.npm);const t=document.getElementById("audioFile"),r=document.getElementById("response");if(t.files.length)try{const a=await e.uploadAudio({audio_file:t.files[0]});console.log("hello",a),r.textContent=a?`Transcription ID: ${a.id}, Language: ${a.language}, Confidence: ${a.confidence}`:`Error: ${a.cause}`}catch(e){console.log(e),r.textContent="Upload failed. Please try again."}else r.textContent="Please qselect an audio file."}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MEksZUFBZSxZQUU3QyxHQUFLSSxFQUFVRSxNQUFNMUgsT0FLckIsSUFDSSxNQUFNeUMsUUFBaUI2RSxFQUFjOUIsWUFBWSxDQUM3Q21DLFdBQVlILEVBQVVFLE1BQU0sS0FFaEN4RSxRQUFRQyxJQUFJLFFBQVNWLEdBR2pCZ0YsRUFBYUcsWUFEYm5GLEVBQzJCLHFCQUFxQkEsRUFBU21ELGlCQUFpQm5ELEVBQVNBLHlCQUF5QkEsRUFBU29ELGFBRTFGLFVBQVVwRCxFQUFTaUQsT0FFdEQsQ0FBRSxNQUFPeEYsR0FDTGdELFFBQVFDLElBQUlqRCxHQUVadUgsRUFBYUcsWUFBYyxrQ0FDL0IsTUFuQklILEVBQWFHLFlBQWMsK0JBbUIvQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xhbmd1YWdlLWlkZW50aWZpY2F0aW9uLXZvaWNlLy4vbm9kZV9tb2R1bGVzL0ByZXZlcmllaXQvcmV2ZXJpZS1jbGllbnQvaW5kZXguanMiLCJ3ZWJwYWNrOi8vbGFuZ3VhZ2UtaWRlbnRpZmljYXRpb24tdm9pY2Uvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vbGFuZ3VhZ2UtaWRlbnRpZmljYXRpb24tdm9pY2Uvd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vbGFuZ3VhZ2UtaWRlbnRpZmljYXRpb24tdm9pY2Uvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2xhbmd1YWdlLWlkZW50aWZpY2F0aW9uLXZvaWNlL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbGFuZ3VhZ2UtaWRlbnRpZmljYXRpb24tdm9pY2UvLi9zY3JpcHQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiByZXZlcmllLWNsaWVudFxuICogQ29weXJpZ2h0KGMpIDIwMjUgUmV2ZXJpZSBMYW5ndWFnZSBUZWNobm9sb2dpZXNcbiAqIE1JVCBMaWNlbnNlZFxuICovXG5cbid1c2Ugc3RyaWN0J1xuXG5mdW5jdGlvbiBpc0VkaXRhYmxlKGVsZW1lbnQpIHtcbiAgICBpZiAoIWVsZW1lbnQpIHJldHVybiBmYWxzZTtcblxuICAgIC8vIENoZWNrIGlmIGl0J3MgYW4gaW5wdXQgb3IgdGV4dGFyZWFcbiAgICBpZiAoZWxlbWVudC50YWdOYW1lID09PSAnSU5QVVQnIHx8IGVsZW1lbnQudGFnTmFtZSA9PT0gJ1RFWFRBUkVBJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBjb250ZW50ZWRpdGFibGUgaXMgc2V0IHRvIHRydWVcbiAgICBpZiAoZWxlbWVudC5pc0NvbnRlbnRFZGl0YWJsZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cblxuZnVuY3Rpb24gdm9pY2VUZXh0KGV2ZW50LCBjYWxsYmFjaywgZWxlbWVudCwgbGFuZykge1xuXG4gICAgbGV0IHN0dF90ZXh0ID0gZXZlbnQuZGF0YTtcblxuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgIGlmIChpc0VkaXRhYmxlKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAvLyBTdGFydCB2b2ljZSByZWNvZ25pdGlvblxuICAgICAgICAgICAgaWYgKGV2ZW50LmV2ZW50ID09PSBcIkZJTkFMX1JFU1VMVFwiKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2luc2VydFRleHQnLCBmYWxzZSwgc3R0X3RleHQpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmV2ZW50ID09PSBcIlBBUlRJQUxfUkVTVUxUU1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKFtcImVzLUVTXCIsIFwiZnItRlJcIiwgXCJhci1TQVwiXS5pbmNsdWRlcyhsYW5nKSkge1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VGV4dCcsIGZhbHNlLCBzdHRfdGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWVsZW1lbnQgfHwgaXNFZGl0YWJsZShlbGVtZW50KSkge1xuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGxldCBzdHRfZXZlbnQgPSB7IC4uLmV2ZW50IH1cbiAgICAgICAgICAgIGNhbGxiYWNrKHsgc3R0X2V2ZW50IH0pXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIFJldmVyaWVDbGllbnQge1xuICAgIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHtcbiAgICAgICAgdGhpcy5hcGlLZXkgPSBwYXJhbWV0ZXJzLmFwaUtleSB8fCAnUkVWRVJJRV9BUElfS0VZJztcbiAgICAgICAgdGhpcy5hcHBJZCA9IHBhcmFtZXRlcnMuYXBwSWQgfHwgJ1JFVkVSSUVfQVBQX0lEJztcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gcGFyYW1ldGVycy5iYXNlVXJsIHx8ICdodHRwczovL3JldmFwaS5yZXZlcmllaW5jLmNvbS8nO1xuICAgICAgICB0aGlzLmlzTGlzdGVuaW5nID0gZmFsc2U7XG5cbiAgICAgICAgbGV0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICBzY3JpcHQuc3JjID0gJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vcmV2ZXJpZS1zdHQtc2RrL2Rpc3QvYnVuZGxlLmpzJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuXG4gICAgfVxuXG4gICAgYXN5bmMgdHJhbnNsaXRlcmF0ZSh7IHRleHQsIHNyY19sYW5nLCB0Z3RfbGFuZywgZG9tYWluID0gMSB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXNyY19sYW5nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTb3VyY2UgbGFuZ3VhZ2UgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGd0X2xhbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RhcmdldCBsYW5ndWFnZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IHRvIHRyYW5zbGl0ZXJhdGUgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCByZXNwID0gYXdhaXQgZmV0Y2godGhpcy5iYXNlVXJsLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUEktS0VZXCI6IHRoaXMuYXBpS2V5LFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUFAtSURcIjogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgXCJzcmNfbGFuZ1wiOiBzcmNfbGFuZyxcbiAgICAgICAgICAgICAgICAgICAgXCJ0Z3RfbGFuZ1wiOiB0Z3RfbGFuZyxcbiAgICAgICAgICAgICAgICAgICAgXCJkb21haW5cIjogZG9tYWluLFxuICAgICAgICAgICAgICAgICAgICBcImNudF9sYW5nXCI6IFwiZW5cIixcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBQTkFNRVwiOiBcInRyYW5zbGl0ZXJhdGlvblwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiBbdGV4dF0sXG4gICAgICAgICAgICAgICAgICAgIGlzQnVsazogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGlnbm9yZVRhZ2dlZEVudGl0aWVzOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc3AgPSBhd2FpdCByZXNwLmpzb24oKTtcbiAgICAgICAgICAgIGlmIChyZXNwICYmIHJlc3AucmVzcG9uc2VMaXN0ICYmIHJlc3AucmVzcG9uc2VMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcC5yZXNwb25zZUxpc3RbMF0ub3V0U3RyaW5nWzBdO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gdHJhbnNsaXRlcmF0ZSB0ZXh0XCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG5cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBhc3luYyBhbmFseXplX3RleHQoeyB0ZXh0LCBzcmNfbGFuZywgdGd0X2xhbmcsIHRyYW5zbGF0aW9uX2RvbWFpbiwgbW9kZXJhdGlvbl90eXBlcyB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXNyY19sYW5nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb250ZW50IGxhbmd1YWdlIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgaXMgcmVxdWlyZWQgZm9yIHRleHQgYW5hbHlzaXMnKTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9YXBpL3YyL3RleHQtYW5hbHlzZT90cmFuc2xhdGU9dHJ1ZSZzdW1tYXJ5PXRydWUmc2VudGltZW50PWZhbHNlJmRldGVjdF9lbnRpdGllcz10cnVlJmNvbnRlbnRfc2FmZXR5PXRydWUmcGlpX3JlZGFjdGlvbj10cnVlYDtcblxuICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICdSRVYtQVBJLUtFWSc6IHRoaXMuYXBpS2V5LFxuICAgICAgICAgICAgICAgICdSRVYtQVBQLUlEJzogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAnUkVWLUFQUE5BTUUnOiAndGV4dC1hbmFseXNpcydcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgXCJ0ZXh0XCI6IHRleHQsXG4gICAgICAgICAgICAgICAgXCJsYW5ndWFnZVwiOiBzcmNfbGFuZyxcbiAgICAgICAgICAgICAgICBcInBpaV9yZWRhY3Rpb25cIjoge1xuICAgICAgICAgICAgICAgICAgICBcInJlZGFjdF9waWlfc3ViXCI6IFwiZW50aXR5X25hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJyZWRhY3RfcGlpX3R5cGVzXCI6IFtdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBcInN1bW1hcnlcIjoge1xuICAgICAgICAgICAgICAgICAgICBcInN1bW1hcnlfbW9kZWxcIjogXCJnZW1tYTI6MmJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzdW1tYXJ5X3R5cGVcIjogXCJnaXN0XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiZW50aXR5X3JlY29nbml0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJlbnRpdHlfdHlwZXNcIjogW11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwic2VudGltZW50XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiBcIndob2xlXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiY29udGVudF9tb2RlcmF0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJtb2RlcmF0aW9uX3R5cGVzXCI6IG1vZGVyYXRpb25fdHlwZXMgfHwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJoYXRlX3NwZWVjaFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9mYW5pdHlcIlxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRndF9sYW5nKSB7XG4gICAgICAgICAgICAgICAgZGF0YVtcInRyYXNsYXRpb25cIl0gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwidGFyZ2V0X2xhbmd1YWdlXCI6IHRndF9sYW5nLFxuICAgICAgICAgICAgICAgICAgICBcInRyYW5zbGF0aW9uX2RvbWFpblwiOiB0cmFuc2xhdGlvbl9kb21haW4gfHwgXCJnZW5lcmljXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5yZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnJlc3VsdHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gYW5hbHl6ZSB0ZXh0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgaWRlbnRpZnlfbGFuZ3VhZ2VfYnlfdGV4dCh7IHRleHQgfSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IHRvIGlkZW50aWZ5IGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGV4dC5sZW5ndGggPiA1MTIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgZXhjZWVkcyBtYXhpbXVtIGxlbmd0aCBvZiA1MTIgY2hhcmFjdGVycycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCBmZXRjaCh0aGlzLmJhc2VVcmwsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQSS1LRVlcIjogdGhpcy5hcGlLZXksXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQUC1JRFwiOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUFBOQU1FXCI6IFwibGFuZ19pZF90ZXh0XCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIFwidGV4dFwiOiB0ZXh0LFxuICAgICAgICAgICAgICAgICAgICBcIm1heF9sZW5ndGhcIjogTWF0aC5wb3coMiwgTWF0aC5mbG9vcihNYXRoLnNxcnQodGV4dC5sZW5ndGgpKSArIDEpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzcCA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgICAgICAgaWYgKHJlc3ApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcDtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGRldGVjdCB0ZXh0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG5cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBhc3luYyB0cmFuc2xhdGUoeyB0ZXh0LCBzcmNfbGFuZywgdGd0X2xhbmcsIGRvbWFpbiB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXNyY19sYW5nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTb3VyY2UgbGFuZ3VhZ2UgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGd0X2xhbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RhcmdldCBsYW5ndWFnZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IHRvIHRyYW5zbGF0ZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCBmZXRjaCh0aGlzLmJhc2VVcmwsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQSS1LRVlcIjogdGhpcy5hcGlLZXksXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQUC1JRFwiOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICBcInNyY19sYW5nXCI6IHNyY19sYW5nLFxuICAgICAgICAgICAgICAgICAgICBcInRndF9sYW5nXCI6IHRndF9sYW5nLFxuICAgICAgICAgICAgICAgICAgICAnZG9tYWluJzogZG9tYWluIHx8ICdnZW5lcmljJyxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFBOQU1FJzogJ2xvY2FsaXphdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQVkVSU0lPTic6ICczLjAnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IFt0ZXh0XSxcbiAgICAgICAgICAgICAgICAgICAgXCJubXRNYXNrXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIFwibm10TWFza1Rlcm1zXCI6IHt9LFxuICAgICAgICAgICAgICAgICAgICBcImVuYWJsZU5tdFwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBcImVuYWJsZUxvb2t1cFwiOiB0cnVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzcCA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC5yZXNwb25zZUxpc3QgJiYgcmVzcC5yZXNwb25zZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwLnJlc3BvbnNlTGlzdFswXS5vdXRTdHJpbmc7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byB0cmFuc2xhdGUgdGV4dFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlO1xuXG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgYXN5bmMgc3R0X2JhdGNoKHsgYXVkaW9GaWxlLCBzcmNfbGFuZywgZG9tYWluIH0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghc3JjX2xhbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvdXJjZSBsYW5ndWFnZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFhdWRpb0ZpbGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgdG8gdHJhbnNjcmliZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiYXVkaW9fZmlsZVwiLCBhdWRpb0ZpbGUpO1xuXG4gICAgICAgICAgICBsZXQgcmVzcCA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9yZXZhcGkucmV2ZXJpZWluYy5jb20vXCIsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJzcmNfbGFuZ1wiOiBzcmNfbGFuZyxcbiAgICAgICAgICAgICAgICAgICAgXCJkb21haW5cIjogZG9tYWluIHx8IFwiZ2VuZXJpY1wiLFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUFBOQU1FXCI6IFwic3R0X2ZpbGVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBJLUtFWVwiOiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBQLUlEXCI6IHRoaXMuYXBwSWQsXG5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmVzcCA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC5kaXNwbGF5X3RleHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcC5kaXNwbGF5X3RleHQ7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byB0cmFuc2NyaWJlIHRleHRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcblxuICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIGFzeW5jIHRleHRfdG9fc3BlZWNoKHsgdGV4dCwgc3BlYWtlciwgc3BlZWQsIHBpdGNoLCBmb3JtYXQgPSAnV0FWJyB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXNwZWFrZXIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NwZWFrZXIgaXMgcmVxdWlyZWQgZm9yIFRUUycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IGlzIHJlcXVpcmVkIGZvciBUVFMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghWydXQVYnLCAnTVAzJ10uaW5jbHVkZXMoZm9ybWF0KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhdWRpbyBmb3JtYXQuIFN1cHBvcnRlZCBmb3JtYXRzIGFyZSB3YXYgYW5kIG1wMycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdERhdGEgPSB7XG4gICAgICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgICAgICBzcGVlZDogcGFyc2VGbG9hdChzcGVlZCksXG4gICAgICAgICAgICAgICAgcGl0Y2g6IHBhcnNlRmxvYXQocGl0Y2gpLFxuICAgICAgICAgICAgICAgIGZvcm1hdDogXCJXQVZcIixcbiAgICAgICAgICAgICAgICBzcGVha2VyXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgcmVzcCA9IGF3YWl0IGZldGNoKHRoaXMuYmFzZVVybCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBJLUtFWVwiOiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBQLUlEXCI6IHRoaXMuYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQUE5BTUVcIjogXCJ0dHNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzcGVha2VyXCI6IHNwZWFrZXIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0RGF0YSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGJsb2IgPSBhd2FpdCByZXNwLmJsb2IoKTtcbiAgICAgICAgICAgIGlmIChyZXNwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2I7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBkbyB0dHMgZm9yIHRoZSB0ZXh0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yO1xuXG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgYXN5bmMgaW5pdF9zdHQoeyBzcmNfbGFuZywgZG9tYWluLCBzaWxlbmNlLCBjb250aW51b3VzLCBsb2dnaW5nLCB0aW1lb3V0LCBjYWxsYmFjaywgZWxlbWVudCB9KSB7XG4gICAgICAgIGlmICghc3JjX2xhbmcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU291cmNlIGxhbmd1YWdlIGlzIHJlcXVpcmVkIGZvciBTVFQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNhbGxiYWNrICYmICFlbGVtZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIG9yIGVsZW1lbnQgaXMgcmVxdWlyZWQgZm9yIFNUVCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnQgJiYgdHlwZW9mIGVsZW1lbnQgIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VsZW1lbnQgbXVzdCBiZSBhIERPTSBlbGVtZW50Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRvbWFpbiAmJiB0eXBlb2YgZG9tYWluICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gbXVzdCBiZSBhIHN0cmluZycpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaWxlbmNlICYmIHR5cGVvZiBzaWxlbmNlICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaWxlbmNlIG11c3QgYmUgYSBudW1iZXInKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGludW91cyAmJiB0eXBlb2YgY29udGludW91cyAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRpbnVvdXMgbXVzdCBiZSBhIGJvb2xlYW4nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobG9nZ2luZyAmJiB0eXBlb2YgbG9nZ2luZyAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvZ2dpbmcgbXVzdCBiZSBhIGJvb2xlYW4nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGltZW91dCAmJiB0eXBlb2YgdGltZW91dCAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGltZW91dCBtdXN0IGJlIGEgbnVtYmVyJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgd2luZG93LnN0dF9zdHJlYW0uaW5pdFNUVCh7XG4gICAgICAgICAgICAgICAgYXBpa2V5OiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICBhcHBJZDogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogc3JjX2xhbmcsXG4gICAgICAgICAgICAgICAgZG9tYWluOiBkb21haW4gfHwgXCJnZW5lcmljXCIsXG4gICAgICAgICAgICAgICAgc2lsZW5jZTogc2lsZW5jZSB8fCAxLFxuICAgICAgICAgICAgICAgIGNvbnRpbnVvdXM6IGNvbnRpbnVvdXMgfHwgMSxcbiAgICAgICAgICAgICAgICBsb2dnaW5nOiBsb2dnaW5nICYmIGxvZ2dpbmcgPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRpbWVvdXQgfHwgMTgwLFxuICAgICAgICAgICAgICAgIGV2ZW50SGFuZGxlcjogKGV2ZW50KSA9PiB2b2ljZVRleHQoZXZlbnQsIGNhbGxiYWNrLCBlbGVtZW50LCBzcmNfbGFuZyksXG4gICAgICAgICAgICAgICAgZXJyb3JIYW5kbGVyOiAoZXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU1RUIFN0cmVhbWluZyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NUVCBJbml0aWFsaXphdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBhc3luYyBzdGFydF9zdHQoKSB7XG4gICAgICAgIGF3YWl0IHdpbmRvdy5zdHRfc3RyZWFtLnN0YXJ0U1RUKCk7XG4gICAgICAgIHRoaXMuaXNMaXN0ZW5pbmcgPSB0cnVlO1xuICAgIH1cblxuICAgIGFzeW5jIHN0b3Bfc3R0KCkge1xuICAgICAgICBhd2FpdCB3aW5kb3cuc3R0X3N0cmVhbS5zdG9wU1RUKCk7XG4gICAgICAgIHRoaXMuaXNMaXN0ZW5pbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBhc3luYyB0b2dnbGVfc3R0KCkge1xuICAgICAgICBpZiAodGhpcy5pc0xpc3RlbmluZykge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zdG9wX3N0dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zdGFydF9zdHQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHRyYW5zbGF0ZURvY3VtZW50KHsgc291cmNlTGFuZ3VhZ2UsIHRhcmdldExhbmd1YWdlLCB1cGxvYWRlZEZpbGUgfSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnc291cmNlTGFuZ3VhZ2UnLCBzb3VyY2VMYW5ndWFnZSB8fCAnZW5nbGlzaCcpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCd0YXJnZXRMYW5ndWFnZScsIHRhcmdldExhbmd1YWdlIHx8ICdoaW5kaScpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdwcm9qZWN0RmlsZXMnLCB1cGxvYWRlZEZpbGUpO1xuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL3JldmFwaS5yZXZlcmllaW5jLmNvbS90cmFuc2xhdGVfZG9jX2ltcG9ydCcsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQLUlEJzogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFBOQU1FJzogJ25tdCcsXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBJLUtFWSc6IHRoaXMuYXBpS2V5XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBmb3JtRGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uub2sgJiYgZGF0YS5wcm9qZWN0SWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja1N0YXR1cyhkYXRhLnByb2plY3RJZCwgdGFyZ2V0TGFuZ3VhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGluIHRyYW5zbGF0aW9uIHByb2Nlc3MnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVHJhbnNsYXRpb24gZmFpbGVkOiAnICsgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjaGVja1N0YXR1cyhkb2NJZCwgdGFyZ2V0TGFuZ3VhZ2UpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBvbGxTdGF0dXMgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9yZXZhcGkucmV2ZXJpZWluYy5jb20vdHJhbnNsYXRlX2RvY19zdGF0dXM/ZG9jX2lkPSR7ZG9jSWR9YCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSRVYtQVBQLUlEJzogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUkVWLUFQUE5BTUUnOiAnbm10JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUkVWLUFQSS1LRVknOiB0aGlzLmFwaUtleVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzRGF0YS5zdWNjZXNzICYmIHN0YXR1c0RhdGEubWVzc2FnZSA9PT0gJ2NvbXBsZXRlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcy5kb3dubG9hZFRyYW5zbGF0ZWRGaWxlKGRvY0lkLCB0YXJnZXRMYW5ndWFnZSkpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChwb2xsU3RhdHVzLCAyMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0Vycm9yIGNoZWNraW5nIHN0YXR1czogJyArIGVycm9yLm1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcG9sbFN0YXR1cygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBkb3dubG9hZFRyYW5zbGF0ZWRGaWxlKGRvY0lkLCB0YXJnZXRMYW5ndWFnZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9yZXZhcGkucmV2ZXJpZWluYy5jb20vdHJhbnNsYXRlX2RvY19leHBvcnQnLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQUC1JRCc6IHRoaXMuYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQTkFNRSc6ICdubXQnLFxuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQSS1LRVknOiB0aGlzLmFwaUtleVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB1bml0SWQ6IGRvY0lkLCB0YXJnZXRMYW5ndWFnZXM6IFt0YXJnZXRMYW5ndWFnZV0gfSlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2VEYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHJlc3BvbnNlRGF0YS5kYXRhLnRhcmdldFVSTFMpLmZvckVhY2gobGFuZ3VhZ2VzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhsYW5ndWFnZXMpLmZvckVhY2goZmlsZVVSTCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihmaWxlVVJMLCAnX2JsYW5rJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiAnVHJhbnNsYXRpb24gY29tcGxldGUhIEZpbGUgaXMgcmVhZHkgZm9yIGRvd25sb2FkLic7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgZG93bmxvYWRpbmcgdHJhbnNsYXRpb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRG93bmxvYWQgZmFpbGVkOiAnICsgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB1cGxvYWREb2N1bWVudCh7IGZpbGUsIGZpbGVfdHlwZSwgbGFuZ3VhZ2VzLCBvY3JfdHlwZSB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIWZpbGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBzZWxlY3QgYSBmaWxlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZmlsZV90eXBlIHx8IChmaWxlX3R5cGUgIT09ICdwZGYnICYmIGZpbGVfdHlwZSAhPT0gJ2ltZycpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmaWxlX3R5cGUuIE11c3QgYmUgJ3BkZicgb3IgJ2ltZydcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghbGFuZ3VhZ2VzKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTGFuZ3VhZ2VzIHBhcmFtZXRlciBpcyByZXF1aXJlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFvY3JfdHlwZSB8fCAob2NyX3R5cGUgIT09ICdsYXlvdXRfb2NyJyAmJiBvY3JfdHlwZSAhPT0gJ29ubHlfb2NyJykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIG9jcl90eXBlLiBNdXN0IGJlICdsYXlvdXRfb2NyJyBvciAnb25seV9vY3InXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZmlsZV90eXBlID09PSAnaW1nJyAmJiBvY3JfdHlwZSA9PT0gJ2xheW91dF9vY3InKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdMYXlvdXQgT0NSIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIGltYWdlcy4gUGxlYXNlIHNlbGVjdCBPbmx5IE9DUi4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlX3R5cGUnLCBmaWxlX3R5cGUpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdsYW5ndWFnZXMnLCBsYW5ndWFnZXMpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdvY3JfdHlwZScsIG9jcl90eXBlKTtcblxuICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5iYXNlVXJsICsgJy9wcm9jZXNzX2RvYycsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQLUlEJzogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUEktS0VZJzogdGhpcy5hcGlLZXksXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQTkFNRSc6ICdvY3InXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBmb3JtRGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChvY3JfdHlwZSA9PT0gJ2xheW91dF9vY3InKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmJsb2IoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBhc3luYyB1cGxvYWRBdWRpbyh7IGZpbGUgfSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCFmaWxlKSB0aHJvdyBuZXcgRXJyb3IoJ1BsZWFzZSBzZWxlY3QgYW4gYXVkaW8gZmlsZScpO1xuXG4gICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdhdWRpb19maWxlJywgZmlsZSk7XG5cbiAgICAgICAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRoaXMuYmFzZVVybCArICcvdXBsb2FkJywge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUEktS0VZJzogdGhpcy5hcGlLZXksXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQLUlEJzogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFBOQU1FJzogJ3NsaWQnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBmb3JtRGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmNhdXNlKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0cmFuc2NyaXB0aW9uSWQ6IHJlc3VsdC5pZCxcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogcmVzdWx0Lmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgIGNvbmZpZGVuY2U6IHJlc3VsdC5jb25maWRlbmNlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cblxuXG59XG5cbm1vZHVsZS5leHBvcnRzID0gUmV2ZXJpZUNsaWVudCIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJpbXBvcnQgUmV2ZXJpZUNsaWVudCBmcm9tIFwiQHJldmVyaWVpdC9yZXZlcmllLWNsaWVudFwiO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1cGxvYWRCdG5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJldmVyaWVDbGllbnQgPSBuZXcgUmV2ZXJpZUNsaWVudCh7XHJcbiAgICAgICAgYXBpS2V5OiBcImRhMWMxMmFjZmVlOGEyMDRjZjZhMTM1ZWMwMTU3ZDZhZGFmZmQ0NzhcIixcclxuICAgICAgICBhcHBJZDogXCJjb20ubnBtcGFja2FnZVwiLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJoZXlcIiwgcmV2ZXJpZUNsaWVudC5ucG0pO1xyXG5cclxuXHJcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF1ZGlvRmlsZVwiKTtcclxuICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzcG9uc2VcIik7XHJcblxyXG4gICAgaWYgKCFmaWxlSW5wdXQuZmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgcmVzcG9uc2VUZXh0LnRleHRDb250ZW50ID0gXCJQbGVhc2UgcXNlbGVjdCBhbiBhdWRpbyBmaWxlLlwiO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGxhbmd1YWdlID0gYXdhaXQgcmV2ZXJpZUNsaWVudC51cGxvYWRBdWRpbyh7XHJcbiAgICAgICAgICAgIGF1ZGlvX2ZpbGU6IGZpbGVJbnB1dC5maWxlc1swXSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImhlbGxvXCIsIGxhbmd1YWdlKTtcclxuXHJcbiAgICAgICAgaWYgKGxhbmd1YWdlKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlVGV4dC50ZXh0Q29udGVudCA9IGBUcmFuc2NyaXB0aW9uIElEOiAke2xhbmd1YWdlLmlkfSwgTGFuZ3VhZ2U6ICR7bGFuZ3VhZ2UubGFuZ3VhZ2V9LCBDb25maWRlbmNlOiAke2xhbmd1YWdlLmNvbmZpZGVuY2V9YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXNwb25zZVRleHQudGV4dENvbnRlbnQgPSBgRXJyb3I6ICR7bGFuZ3VhZ2UuY2F1c2V9YDtcclxuICAgICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuXHJcbiAgICAgICAgcmVzcG9uc2VUZXh0LnRleHRDb250ZW50ID0gXCJVcGxvYWQgZmFpbGVkLiBQbGVhc2UgdHJ5IGFnYWluLlwiO1xyXG4gICAgfVxyXG59KTtcclxuIl0sIm5hbWVzIjpbImlzRWRpdGFibGUiLCJlbGVtZW50IiwidGFnTmFtZSIsImlzQ29udGVudEVkaXRhYmxlIiwibW9kdWxlIiwiZXhwb3J0cyIsImNvbnN0cnVjdG9yIiwicGFyYW1ldGVycyIsInRoaXMiLCJhcGlLZXkiLCJhcHBJZCIsImJhc2VVcmwiLCJpc0xpc3RlbmluZyIsInNjcmlwdCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNyYyIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInRyYW5zbGl0ZXJhdGUiLCJ0ZXh0Iiwic3JjX2xhbmciLCJ0Z3RfbGFuZyIsImRvbWFpbiIsIkVycm9yIiwicmVzcCIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiaXNCdWxrIiwiaWdub3JlVGFnZ2VkRW50aXRpZXMiLCJqc29uIiwicmVzcG9uc2VMaXN0IiwibGVuZ3RoIiwib3V0U3RyaW5nIiwiZXJyb3IiLCJtZXNzYWdlIiwiYW5hbHl6ZV90ZXh0IiwidHJhbnNsYXRpb25fZG9tYWluIiwibW9kZXJhdGlvbl90eXBlcyIsInVybCIsInJlc3BvbnNlIiwicmVzdWx0cyIsImlkZW50aWZ5X2xhbmd1YWdlX2J5X3RleHQiLCJNYXRoIiwicG93IiwiZmxvb3IiLCJzcXJ0IiwidHJhbnNsYXRlIiwic3R0X2JhdGNoIiwiYXVkaW9GaWxlIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsImRpc3BsYXlfdGV4dCIsInRleHRfdG9fc3BlZWNoIiwic3BlYWtlciIsInNwZWVkIiwicGl0Y2giLCJmb3JtYXQiLCJpbmNsdWRlcyIsInJlcXVlc3REYXRhIiwicGFyc2VGbG9hdCIsImJsb2IiLCJpbml0X3N0dCIsInNpbGVuY2UiLCJjb250aW51b3VzIiwibG9nZ2luZyIsInRpbWVvdXQiLCJjYWxsYmFjayIsIndpbmRvdyIsInN0dF9zdHJlYW0iLCJpbml0U1RUIiwiYXBpa2V5IiwibGFuZ3VhZ2UiLCJldmVudEhhbmRsZXIiLCJldmVudCIsImxhbmciLCJzdHRfdGV4dCIsImV4ZWNDb21tYW5kIiwic3R0X2V2ZW50Iiwidm9pY2VUZXh0IiwiZXJyb3JIYW5kbGVyIiwiY29uc29sZSIsImxvZyIsInN0YXJ0X3N0dCIsInN0YXJ0U1RUIiwic3RvcF9zdHQiLCJzdG9wU1RUIiwidG9nZ2xlX3N0dCIsInRyYW5zbGF0ZURvY3VtZW50Iiwic291cmNlTGFuZ3VhZ2UiLCJ0YXJnZXRMYW5ndWFnZSIsInVwbG9hZGVkRmlsZSIsIm9rIiwicHJvamVjdElkIiwiY2hlY2tTdGF0dXMiLCJkb2NJZCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwicG9sbFN0YXR1cyIsImFzeW5jIiwic3RhdHVzRGF0YSIsInN1Y2Nlc3MiLCJkb3dubG9hZFRyYW5zbGF0ZWRGaWxlIiwic2V0VGltZW91dCIsInVuaXRJZCIsInRhcmdldExhbmd1YWdlcyIsInJlc3BvbnNlRGF0YSIsIk9iamVjdCIsInZhbHVlcyIsInRhcmdldFVSTFMiLCJmb3JFYWNoIiwibGFuZ3VhZ2VzIiwiZmlsZVVSTCIsIm9wZW4iLCJ1cGxvYWREb2N1bWVudCIsImZpbGUiLCJmaWxlX3R5cGUiLCJvY3JfdHlwZSIsInVwbG9hZEF1ZGlvIiwicmVzdWx0IiwiY2F1c2UiLCJ0cmFuc2NyaXB0aW9uSWQiLCJpZCIsImNvbmZpZGVuY2UiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwibiIsImdldHRlciIsIl9fZXNNb2R1bGUiLCJkIiwiYSIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImdldEVsZW1lbnRCeUlkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJldmVyaWVDbGllbnQiLCJucG0iLCJmaWxlSW5wdXQiLCJyZXNwb25zZVRleHQiLCJmaWxlcyIsImF1ZGlvX2ZpbGUiLCJ0ZXh0Q29udGVudCJdLCJzb3VyY2VSb290IjoiIn0=