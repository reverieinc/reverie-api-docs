/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={913:e=>{function t(e){return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&!e.isContentEditable)}e.exports=class{constructor(e){this.apiKey=e.apiKey||"REVERIE_API_KEY",this.appId=e.appId||"REVERIE_APP_ID",this.baseUrl=e.baseUrl||"https://revapi.reverieinc.com/",this.isListening=!1;let t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/reverie-stt-sdk/dist/bundle.js",document.body.appendChild(t)}async transliterate({text:e,src_lang:t,tgt_lang:r,domain:a=1}){try{if(!t)throw new Error("Source language is required");if(!r)throw new Error("Target language is required");if(!e)throw new Error("Text to transliterate is required");let n=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,src_lang:t,tgt_lang:r,domain:a,cnt_lang:"en","REV-APPNAME":"transliteration"},body:JSON.stringify({data:[e],isBulk:!1,ignoreTaggedEntities:!1})});if(n=await n.json(),n&&n.responseList&&n.responseList.length>0)return n.responseList[0].outString[0];throw new Error("Failed to transliterate text")}catch(e){return e.message}}async analyze_text({text:e,src_lang:t,tgt_lang:r,translation_domain:a,moderation_types:n}){try{if(!t)throw new Error("Content language is required");if(!e)throw new Error("Text is required for text analysis");const o=`${this.baseUrl}api/v2/text-analyse?translate=true&summary=true&sentiment=false&detect_entities=true&content_safety=true&pii_redaction=true`,i={"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"text-analysis"},s={text:e,language:t,pii_redaction:{redact_pii_sub:"entity_name",redact_pii_types:[]},summary:{summary_model:"gemma2:2b",summary_type:"gist"},entity_recognition:{entity_types:[]},sentiment:{level:"whole"},content_moderation:{moderation_types:n||["hate_speech","profanity"]}};r&&(s.traslation={target_language:r,translation_domain:a||"generic"});let l=await fetch(o,{method:"POST",headers:i,body:JSON.stringify(s)});if(l=await l.json(),l&&l.results)return l.results;throw new Error("Failed to analyze text")}catch(e){return e.message}}async identify_language_by_text({text:e}){try{if(!e)throw new Error("Text to identify is required");if(e.length>512)throw new Error("Text exceeds maximum length of 512 characters");let t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"lang_id_text"},body:JSON.stringify({text:e,max_length:Math.pow(2,Math.floor(Math.sqrt(e.length))+1)})});if(t=await t.json(),t)return t;throw new Error("Failed to detect text")}catch(e){return e.message}}async translate({text:e,src_lang:t,tgt_lang:r,domain:a}){try{if(!t)throw new Error("Source language is required");if(!r)throw new Error("Target language is required");if(!e)throw new Error("Text to translate is required");let n=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,src_lang:t,tgt_lang:r,domain:a||"generic","REV-APPNAME":"localization","REV-APPVERSION":"3.0"},body:JSON.stringify({data:[e],nmtMask:!0,nmtMaskTerms:{},enableNmt:!0,enableLookup:!0})});if(n=await n.json(),n&&n.responseList&&n.responseList.length>0)return n.responseList[0].outString;throw new Error("Failed to translate text")}catch(e){return e.message}}async stt_batch({audioFile:e,src_lang:t,domain:r}){try{if(!t)throw new Error("Source language is required");if(!e)throw new Error("File to transcribe is required");const a=new FormData;a.append("audio_file",e);let n=await fetch("https://revapi.reverieinc.com/",{method:"POST",headers:{src_lang:t,domain:r||"generic","REV-APPNAME":"stt_file","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId},body:a});if(n=await n.json(),n&&n.display_text)return n.display_text;throw new Error("Failed to transcribe text")}catch(e){return e.message}}async text_to_speech({text:e,speaker:t,speed:r,pitch:a,format:n="WAV"}){try{if(!t)throw new Error("Speaker is required for TTS");if(!e)throw new Error("Text is required for TTS");if(!["WAV","MP3"].includes(n))throw new Error("Invalid audio format. Supported formats are wav and mp3");const o={text:e,speed:parseFloat(r),pitch:parseFloat(a),format:"WAV",speaker:t};let i=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json","REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"tts",speaker:t},body:JSON.stringify(o)}),s=await i.blob();if(i)return s;throw new Error("Failed to do tts for the text")}catch(e){return e}}async init_stt({src_lang:e,domain:r,silence:a,continuous:n,logging:o,timeout:i,callback:s,element:l}){if(!e)throw new Error("Source language is required for STT");if(!s&&!l)throw new Error("Callback or element is required for STT");if(s&&"function"!=typeof s)throw new Error("Callback must be a function");if(l&&"object"!=typeof l)throw new Error("Element must be a DOM element");if(r&&"string"!=typeof r)throw new Error("Domain must be a string");if(a&&"number"!=typeof a)throw new Error("Silence must be a number");if(n&&"boolean"!=typeof n)throw new Error("Continuous must be a boolean");if(o&&"boolean"!=typeof o)throw new Error("Logging must be a boolean");if(i&&"number"!=typeof i)throw new Error("Timeout must be a number");try{await window.stt_stream.initSTT({apikey:this.apiKey,appId:this.appId,language:e,domain:r||"generic",silence:a||1,continuous:n||1,logging:!o||!1!==o,timeout:i||180,eventHandler:r=>function(e,r,a,n){let o=e.data;a&&t(a)&&("FINAL_RESULT"===e.event||"PARTIAL_RESULTS"===e.event&&["es-ES","fr-FR","ar-SA"].includes(n))&&document.execCommand("insertText",!1,o),a&&!t(a)||!r||r({stt_event:{...e}})}(r,s,l,e),errorHandler:e=>console.error("Error:",e)}),console.log("STT Streaming initialized successfully")}catch(e){console.error("STT Initialization failed:",e)}}async start_stt(){await window.stt_stream.startSTT(),this.isListening=!0}async stop_stt(){await window.stt_stream.stopSTT(),this.isListening=!1}async toggle_stt(){this.isListening?await this.stop_stt():await this.start_stt()}async translateDocument({sourceLanguage:e,targetLanguage:t,uploadedFile:r}){try{const a=new FormData;a.append("sourceLanguage",e||"english"),a.append("targetLanguage",t||"hindi"),a.append("projectFiles",r);const n=await fetch("https://revapi.reverieinc.com/translate_doc_import",{method:"POST",headers:{"REV-APP-ID":this.appId,"REV-APPNAME":"nmt","REV-API-KEY":this.apiKey},body:a}),o=await n.json();if(n.ok&&o.projectId)return this.checkStatus(o.projectId,t);throw new Error("Error in translation process")}catch(e){throw new Error("Translation failed: "+e.message)}}async checkStatus(e,t){return new Promise(((r,a)=>{const n=async()=>{try{const a=await fetch(`https://revapi.reverieinc.com/translate_doc_status?doc_id=${e}`,{headers:{"REV-APP-ID":this.appId,"REV-APPNAME":"nmt","REV-API-KEY":this.apiKey}}),o=await a.json();o.success&&"completed"===o.message?r(this.downloadTranslatedFile(e,t)):setTimeout(n,2e3)}catch(e){a(new Error("Error checking status: "+e.message))}};n()}))}async downloadTranslatedFile(e,t){try{const r=await fetch("https://revapi.reverieinc.com/translate_doc_export",{method:"POST",headers:{"Content-Type":"application/json","REV-APP-ID":this.appId,"REV-APPNAME":"nmt","REV-API-KEY":this.apiKey},body:JSON.stringify({unitId:e,targetLanguages:[t]})}),a=await r.json();if(a.success)return Object.values(a.data.targetURLS).forEach((e=>{Object.values(e).forEach((e=>{window.open(e,"_blank")}))})),"Translation complete! File is ready for download.";throw new Error("Error downloading translation")}catch(e){throw new Error("Download failed: "+e.message)}}async uploadDocument({file:e,file_type:t,languages:r,ocr_type:a}){try{if(!e)throw new Error("Please select a file");if(!t||"pdf"!==t&&"img"!==t)throw new Error("Invalid file_type. Must be 'pdf' or 'img'");if(!r)throw new Error("Languages parameter is required");if(!a||"layout_ocr"!==a&&"only_ocr"!==a)throw new Error("Invalid ocr_type. Must be 'layout_ocr' or 'only_ocr'");if("img"===t&&"layout_ocr"===a)throw new Error("Layout OCR is not supported for images. Please select Only OCR.");const n=new FormData;n.append("file",e),n.append("file_type",t),n.append("languages",r),n.append("ocr_type",a);let o=await fetch(this.baseUrl+"/process_doc",{method:"POST",headers:{"REV-APP-ID":this.appId,"REV-API-KEY":this.apiKey,"REV-APPNAME":"ocr"},body:n});return"layout_ocr"===a?await o.blob():await o.text()}catch(e){return e.message}}async uploadAudio({file:e}){try{if(!e)throw new Error("Please select an audio file");const t=new FormData;t.append("audio_file",e);let r=await fetch(this.baseUrl+"/upload",{method:"POST",headers:{"REV-API-KEY":this.apiKey,"REV-APP-ID":this.appId,"REV-APPNAME":"slid"},body:t}),a=await r.json();if(!a.success)throw new Error(a.cause);return{transcriptionId:a.id,language:a.language,confidence:a.confidence}}catch(e){throw e}}}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=r(913),n=r.n(a);document.getElementById("uploadBtn").addEventListener("click",(async()=>{const e=document.getElementById("fileInput").files[0],t=document.getElementById("languageSelect"),r=Array.from(t.selectedOptions).map((e=>e.value)).join(","),a=document.getElementById("ocrTypeSelect").value,o=document.getElementById("response"),i=document.getElementById("loader"),s=new(n())({apiKey:"da1c12acfee8a204cf6a135ec0157d6adaffd478",appId:"com.npmpackage"});if(!e)return void alert("Please select a file");const l="application/pdf"===e.type?"pdf":"img";if("img"!==l||"layout_ocr"!==a){o.textContent="",i.style.display="block";try{const t=await s.uploadDocument({file:e,file_type:l,languages:r,ocr_type:a});if("layout_ocr"===a){const e=window.URL.createObjectURL(t),r=document.createElement("a");r.href=e,r.download="output.docx",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(e),o.textContent="File downloaded successfully."}else o.textContent=t}catch(e){console.error("Error:",e),o.textContent="Error occurred while processing"}finally{i.style.display="none"}}else alert("Layout OCR is not supported for images. Please select Only OCR.")}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBRUpDLEVBQWdCdEosU0FBUzBJLGVBQWUsaUJBQWlCVSxNQUN6REcsRUFBZXZKLFNBQVMwSSxlQUFlLFlBQ3ZDYyxFQUFTeEosU0FBUzBJLGVBQWUsVUFFakNlLEVBQWdCLElBQUksSUFBSixDQUFrQixDQUNwQzlKLE9BQVEsMkNBQ1JDLE1BQU8sbUJBR1gsSUFBSytHLEVBRUQsWUFEQStDLE1BQU0sd0JBSVYsTUFBTUMsRUFBeUIsb0JBQWRoRCxFQUFLaUQsS0FBNkIsTUFBUSxNQUMzRCxHQUFpQixRQUFiRCxHQUF3QyxlQUFsQkwsRUFBMUIsQ0FLQUMsRUFBYU0sWUFBYyxHQUMzQkwsRUFBT00sTUFBTUMsUUFBVSxRQUV2QixJQUdJLE1BQU1oRCxRQUFlMEMsRUFBYy9DLGVBQWUsQ0FDOUNDLEtBQU1BLEVBQ05DLFVBQVcrQyxFQUNYcEQsVUFBV3VDLEVBQ1hqQyxTQUFVeUMsSUFHZCxHQUFzQixlQUFsQkEsRUFBZ0MsQ0FDaEMsTUFBTXpILEVBQU04QixPQUFPcUcsSUFBSUMsZ0JBQWdCbEQsR0FDakNlLEVBQUk5SCxTQUFTQyxjQUFjLEtBQ2pDNkgsRUFBRW9DLEtBQU9ySSxFQUNUaUcsRUFBRXFDLFNBQVcsY0FDYm5LLFNBQVNHLEtBQUtDLFlBQVkwSCxHQUMxQkEsRUFBRXNDLFFBQ0Z6RyxPQUFPcUcsSUFBSUssZ0JBQWdCeEksR0FDM0IwSCxFQUFhTSxZQUFjLCtCQUMvQixNQUNJTixFQUFhTSxZQUFjOUMsQ0FFbkMsQ0FBRSxNQUFPdkYsR0FDTGdELFFBQVFoRCxNQUFNLFNBQVVBLEdBQ3hCK0gsRUFBYU0sWUFBYyxpQ0FDL0IsQ0FBRSxRQUNFTCxFQUFPTSxNQUFNQyxRQUFVLE1BQzNCLENBaENBLE1BRklMLE1BQU0sa0VBa0NWIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2NyLy4vbm9kZV9tb2R1bGVzL0ByZXZlcmllaXQvcmV2ZXJpZS1jbGllbnQvaW5kZXguanMiLCJ3ZWJwYWNrOi8vb2NyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL29jci93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly9vY3Ivd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL29jci93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL29jci8uL3NjcmlwdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIHJldmVyaWUtY2xpZW50XG4gKiBDb3B5cmlnaHQoYykgMjAyNSBSZXZlcmllIExhbmd1YWdlIFRlY2hub2xvZ2llc1xuICogTUlUIExpY2Vuc2VkXG4gKi9cblxuJ3VzZSBzdHJpY3QnXG5cbmZ1bmN0aW9uIGlzRWRpdGFibGUoZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhbiBpbnB1dCBvciB0ZXh0YXJlYVxuICAgIGlmIChlbGVtZW50LnRhZ05hbWUgPT09ICdJTlBVVCcgfHwgZWxlbWVudC50YWdOYW1lID09PSAnVEVYVEFSRUEnKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGNvbnRlbnRlZGl0YWJsZSBpcyBzZXQgdG8gdHJ1ZVxuICAgIGlmIChlbGVtZW50LmlzQ29udGVudEVkaXRhYmxlKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuXG5mdW5jdGlvbiB2b2ljZVRleHQoZXZlbnQsIGNhbGxiYWNrLCBlbGVtZW50LCBsYW5nKSB7XG5cbiAgICBsZXQgc3R0X3RleHQgPSBldmVudC5kYXRhO1xuXG4gICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGlzRWRpdGFibGUoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIC8vIFN0YXJ0IHZvaWNlIHJlY29nbml0aW9uXG4gICAgICAgICAgICBpZiAoZXZlbnQuZXZlbnQgPT09IFwiRklOQUxfUkVTVUxUXCIpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0VGV4dCcsIGZhbHNlLCBzdHRfdGV4dCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZXZlbnQgPT09IFwiUEFSVElBTF9SRVNVTFRTXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoW1wiZXMtRVNcIiwgXCJmci1GUlwiLCBcImFyLVNBXCJdLmluY2x1ZGVzKGxhbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRUZXh0JywgZmFsc2UsIHN0dF90ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghZWxlbWVudCB8fCBpc0VkaXRhYmxlKGVsZW1lbnQpKSB7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgbGV0IHN0dF9ldmVudCA9IHsgLi4uZXZlbnQgfVxuICAgICAgICAgICAgY2FsbGJhY2soeyBzdHRfZXZlbnQgfSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgUmV2ZXJpZUNsaWVudCB7XG4gICAgY29uc3RydWN0b3IocGFyYW1ldGVycykge1xuICAgICAgICB0aGlzLmFwaUtleSA9IHBhcmFtZXRlcnMuYXBpS2V5IHx8ICdSRVZFUklFX0FQSV9LRVknO1xuICAgICAgICB0aGlzLmFwcElkID0gcGFyYW1ldGVycy5hcHBJZCB8fCAnUkVWRVJJRV9BUFBfSUQnO1xuICAgICAgICB0aGlzLmJhc2VVcmwgPSBwYXJhbWV0ZXJzLmJhc2VVcmwgfHwgJ2h0dHBzOi8vcmV2YXBpLnJldmVyaWVpbmMuY29tLyc7XG4gICAgICAgIHRoaXMuaXNMaXN0ZW5pbmcgPSBmYWxzZTtcblxuICAgICAgICBsZXQgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgIHNjcmlwdC5zcmMgPSAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9yZXZlcmllLXN0dC1zZGsvZGlzdC9idW5kbGUuanMnO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7XG5cbiAgICB9XG5cbiAgICBhc3luYyB0cmFuc2xpdGVyYXRlKHsgdGV4dCwgc3JjX2xhbmcsIHRndF9sYW5nLCBkb21haW4gPSAxIH0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghc3JjX2xhbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvdXJjZSBsYW5ndWFnZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0Z3RfbGFuZykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGFyZ2V0IGxhbmd1YWdlIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgdG8gdHJhbnNsaXRlcmF0ZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCBmZXRjaCh0aGlzLmJhc2VVcmwsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQSS1LRVlcIjogdGhpcy5hcGlLZXksXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQUC1JRFwiOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICBcInNyY19sYW5nXCI6IHNyY19sYW5nLFxuICAgICAgICAgICAgICAgICAgICBcInRndF9sYW5nXCI6IHRndF9sYW5nLFxuICAgICAgICAgICAgICAgICAgICBcImRvbWFpblwiOiBkb21haW4sXG4gICAgICAgICAgICAgICAgICAgIFwiY250X2xhbmdcIjogXCJlblwiLFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUFBOQU1FXCI6IFwidHJhbnNsaXRlcmF0aW9uXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IFt0ZXh0XSxcbiAgICAgICAgICAgICAgICAgICAgaXNCdWxrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgaWdub3JlVGFnZ2VkRW50aXRpZXM6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzcCA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC5yZXNwb25zZUxpc3QgJiYgcmVzcC5yZXNwb25zZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwLnJlc3BvbnNlTGlzdFswXS5vdXRTdHJpbmdbMF07XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byB0cmFuc2xpdGVyYXRlIHRleHRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcblxuICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIGFzeW5jIGFuYWx5emVfdGV4dCh7IHRleHQsIHNyY19sYW5nLCB0Z3RfbGFuZywgdHJhbnNsYXRpb25fZG9tYWluLCBtb2RlcmF0aW9uX3R5cGVzIH0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghc3JjX2xhbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnRlbnQgbGFuZ3VhZ2UgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGV4dCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGV4dCBpcyByZXF1aXJlZCBmb3IgdGV4dCBhbmFseXNpcycpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH1hcGkvdjIvdGV4dC1hbmFseXNlP3RyYW5zbGF0ZT10cnVlJnN1bW1hcnk9dHJ1ZSZzZW50aW1lbnQ9ZmFsc2UmZGV0ZWN0X2VudGl0aWVzPXRydWUmY29udGVudF9zYWZldHk9dHJ1ZSZwaWlfcmVkYWN0aW9uPXRydWVgO1xuXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgJ1JFVi1BUEktS0VZJzogdGhpcy5hcGlLZXksXG4gICAgICAgICAgICAgICAgJ1JFVi1BUFAtSUQnOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICdSRVYtQVBQTkFNRSc6ICd0ZXh0LWFuYWx5c2lzJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBcInRleHRcIjogdGV4dCxcbiAgICAgICAgICAgICAgICBcImxhbmd1YWdlXCI6IHNyY19sYW5nLFxuICAgICAgICAgICAgICAgIFwicGlpX3JlZGFjdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwicmVkYWN0X3BpaV9zdWJcIjogXCJlbnRpdHlfbmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcInJlZGFjdF9waWlfdHlwZXNcIjogW11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwic3VtbWFyeVwiOiB7XG4gICAgICAgICAgICAgICAgICAgIFwic3VtbWFyeV9tb2RlbFwiOiBcImdlbW1hMjoyYlwiLFxuICAgICAgICAgICAgICAgICAgICBcInN1bW1hcnlfdHlwZVwiOiBcImdpc3RcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJlbnRpdHlfcmVjb2duaXRpb25cIjoge1xuICAgICAgICAgICAgICAgICAgICBcImVudGl0eV90eXBlc1wiOiBbXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJzZW50aW1lbnRcIjoge1xuICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IFwid2hvbGVcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJjb250ZW50X21vZGVyYXRpb25cIjoge1xuICAgICAgICAgICAgICAgICAgICBcIm1vZGVyYXRpb25fdHlwZXNcIjogbW9kZXJhdGlvbl90eXBlcyB8fCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBcImhhdGVfc3BlZWNoXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInByb2Zhbml0eVwiXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodGd0X2xhbmcpIHtcbiAgICAgICAgICAgICAgICBkYXRhW1widHJhc2xhdGlvblwiXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJ0YXJnZXRfbGFuZ3VhZ2VcIjogdGd0X2xhbmcsXG4gICAgICAgICAgICAgICAgICAgIFwidHJhbnNsYXRpb25fZG9tYWluXCI6IHRyYW5zbGF0aW9uX2RvbWFpbiB8fCBcImdlbmVyaWNcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVzdWx0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBhbmFseXplIHRleHRcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBpZGVudGlmeV9sYW5ndWFnZV9ieV90ZXh0KHsgdGV4dCB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgdG8gaWRlbnRpZnkgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDUxMikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGV4dCBleGNlZWRzIG1heGltdW0gbGVuZ3RoIG9mIDUxMiBjaGFyYWN0ZXJzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcmVzcCA9IGF3YWl0IGZldGNoKHRoaXMuYmFzZVVybCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBJLUtFWVwiOiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBQLUlEXCI6IHRoaXMuYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQUE5BTUVcIjogXCJsYW5nX2lkX3RleHRcIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgXCJ0ZXh0XCI6IHRleHQsXG4gICAgICAgICAgICAgICAgICAgIFwibWF4X2xlbmd0aFwiOiBNYXRoLnBvdygyLCBNYXRoLmZsb29yKE1hdGguc3FydCh0ZXh0Lmxlbmd0aCkpICsgMSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNwID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICAgICAgICBpZiAocmVzcCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZGV0ZWN0IHRleHRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcblxuICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIGFzeW5jIHRyYW5zbGF0ZSh7IHRleHQsIHNyY19sYW5nLCB0Z3RfbGFuZywgZG9tYWluIH0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghc3JjX2xhbmcpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvdXJjZSBsYW5ndWFnZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0Z3RfbGFuZykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGFyZ2V0IGxhbmd1YWdlIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgdG8gdHJhbnNsYXRlIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcmVzcCA9IGF3YWl0IGZldGNoKHRoaXMuYmFzZVVybCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBJLUtFWVwiOiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBQLUlEXCI6IHRoaXMuYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgIFwic3JjX2xhbmdcIjogc3JjX2xhbmcsXG4gICAgICAgICAgICAgICAgICAgIFwidGd0X2xhbmdcIjogdGd0X2xhbmcsXG4gICAgICAgICAgICAgICAgICAgICdkb21haW4nOiBkb21haW4gfHwgJ2dlbmVyaWMnLFxuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQUE5BTUUnOiAnbG9jYWxpemF0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFBWRVJTSU9OJzogJzMuMCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogW3RleHRdLFxuICAgICAgICAgICAgICAgICAgICBcIm5tdE1hc2tcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgXCJubXRNYXNrVGVybXNcIjoge30sXG4gICAgICAgICAgICAgICAgICAgIFwiZW5hYmxlTm10XCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIFwiZW5hYmxlTG9va3VwXCI6IHRydWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNwID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICAgICAgICBpZiAocmVzcCAmJiByZXNwLnJlc3BvbnNlTGlzdCAmJiByZXNwLnJlc3BvbnNlTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3AucmVzcG9uc2VMaXN0WzBdLm91dFN0cmluZztcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHRyYW5zbGF0ZSB0ZXh0XCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG5cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBhc3luYyBzdHRfYmF0Y2goeyBhdWRpb0ZpbGUsIHNyY19sYW5nLCBkb21haW4gfSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCFzcmNfbGFuZykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU291cmNlIGxhbmd1YWdlIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWF1ZGlvRmlsZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmlsZSB0byB0cmFuc2NyaWJlIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJhdWRpb19maWxlXCIsIGF1ZGlvRmlsZSk7XG5cbiAgICAgICAgICAgIGxldCByZXNwID0gYXdhaXQgZmV0Y2goXCJodHRwczovL3JldmFwaS5yZXZlcmllaW5jLmNvbS9cIiwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBcInNyY19sYW5nXCI6IHNyY19sYW5nLFxuICAgICAgICAgICAgICAgICAgICBcImRvbWFpblwiOiBkb21haW4gfHwgXCJnZW5lcmljXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiUkVWLUFQUE5BTUVcIjogXCJzdHRfZmlsZVwiLFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUEktS0VZXCI6IHRoaXMuYXBpS2V5LFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUFAtSURcIjogdGhpcy5hcHBJZCxcblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm9keTogZm9ybURhdGFcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXNwID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICAgICAgICBpZiAocmVzcCAmJiByZXNwLmRpc3BsYXlfdGV4dCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwLmRpc3BsYXlfdGV4dDtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHRyYW5zY3JpYmUgdGV4dFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5tZXNzYWdlO1xuXG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgYXN5bmMgdGV4dF90b19zcGVlY2goeyB0ZXh0LCBzcGVha2VyLCBzcGVlZCwgcGl0Y2gsIGZvcm1hdCA9ICdXQVYnIH0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghc3BlYWtlcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU3BlYWtlciBpcyByZXF1aXJlZCBmb3IgVFRTJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgaXMgcmVxdWlyZWQgZm9yIFRUUycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFbJ1dBVicsICdNUDMnXS5pbmNsdWRlcyhmb3JtYXQpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGF1ZGlvIGZvcm1hdC4gU3VwcG9ydGVkIGZvcm1hdHMgYXJlIHdhdiBhbmQgbXAzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHtcbiAgICAgICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgICAgIHNwZWVkOiBwYXJzZUZsb2F0KHNwZWVkKSxcbiAgICAgICAgICAgICAgICBwaXRjaDogcGFyc2VGbG9hdChwaXRjaCksXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBcIldBVlwiLFxuICAgICAgICAgICAgICAgIHNwZWFrZXJcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxldCByZXNwID0gYXdhaXQgZmV0Y2godGhpcy5iYXNlVXJsLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUEktS0VZXCI6IHRoaXMuYXBpS2V5LFxuICAgICAgICAgICAgICAgICAgICBcIlJFVi1BUFAtSURcIjogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgXCJSRVYtQVBQTkFNRVwiOiBcInR0c1wiLFxuICAgICAgICAgICAgICAgICAgICBcInNwZWFrZXJcIjogc3BlYWtlcixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3REYXRhKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsZXQgYmxvYiA9IGF3YWl0IHJlc3AuYmxvYigpO1xuICAgICAgICAgICAgaWYgKHJlc3ApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYmxvYjtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGRvIHR0cyBmb3IgdGhlIHRleHRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gZXJyb3I7XG5cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBhc3luYyBpbml0X3N0dCh7IHNyY19sYW5nLCBkb21haW4sIHNpbGVuY2UsIGNvbnRpbnVvdXMsIGxvZ2dpbmcsIHRpbWVvdXQsIGNhbGxiYWNrLCBlbGVtZW50IH0pIHtcbiAgICAgICAgaWYgKCFzcmNfbGFuZykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTb3VyY2UgbGFuZ3VhZ2UgaXMgcmVxdWlyZWQgZm9yIFNUVCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2FsbGJhY2sgJiYgIWVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgb3IgZWxlbWVudCBpcyByZXF1aXJlZCBmb3IgU1RUJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbWVudCAmJiB0eXBlb2YgZWxlbWVudCAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRWxlbWVudCBtdXN0IGJlIGEgRE9NIGVsZW1lbnQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9tYWluICYmIHR5cGVvZiBkb21haW4gIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvbWFpbiBtdXN0IGJlIGEgc3RyaW5nJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNpbGVuY2UgJiYgdHlwZW9mIHNpbGVuY2UgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NpbGVuY2UgbXVzdCBiZSBhIG51bWJlcicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250aW51b3VzICYmIHR5cGVvZiBjb250aW51b3VzICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29udGludW91cyBtdXN0IGJlIGEgYm9vbGVhbicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsb2dnaW5nICYmIHR5cGVvZiBsb2dnaW5nICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTG9nZ2luZyBtdXN0IGJlIGEgYm9vbGVhbicpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aW1lb3V0ICYmIHR5cGVvZiB0aW1lb3V0ICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaW1lb3V0IG11c3QgYmUgYSBudW1iZXInKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB3aW5kb3cuc3R0X3N0cmVhbS5pbml0U1RUKHtcbiAgICAgICAgICAgICAgICBhcGlrZXk6IHRoaXMuYXBpS2V5LFxuICAgICAgICAgICAgICAgIGFwcElkOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBzcmNfbGFuZyxcbiAgICAgICAgICAgICAgICBkb21haW46IGRvbWFpbiB8fCBcImdlbmVyaWNcIixcbiAgICAgICAgICAgICAgICBzaWxlbmNlOiBzaWxlbmNlIHx8IDEsXG4gICAgICAgICAgICAgICAgY29udGludW91czogY29udGludW91cyB8fCAxLFxuICAgICAgICAgICAgICAgIGxvZ2dpbmc6IGxvZ2dpbmcgJiYgbG9nZ2luZyA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgdGltZW91dDogdGltZW91dCB8fCAxODAsXG4gICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVyOiAoZXZlbnQpID0+IHZvaWNlVGV4dChldmVudCwgY2FsbGJhY2ssIGVsZW1lbnQsIHNyY19sYW5nKSxcbiAgICAgICAgICAgICAgICBlcnJvckhhbmRsZXI6IChlcnJvcikgPT4gY29uc29sZS5lcnJvcignRXJyb3I6JywgZXJyb3IpLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTVFQgU3RyZWFtaW5nIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignU1RUIEluaXRpYWxpemF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIGFzeW5jIHN0YXJ0X3N0dCgpIHtcbiAgICAgICAgYXdhaXQgd2luZG93LnN0dF9zdHJlYW0uc3RhcnRTVFQoKTtcbiAgICAgICAgdGhpcy5pc0xpc3RlbmluZyA9IHRydWU7XG4gICAgfVxuXG4gICAgYXN5bmMgc3RvcF9zdHQoKSB7XG4gICAgICAgIGF3YWl0IHdpbmRvdy5zdHRfc3RyZWFtLnN0b3BTVFQoKTtcbiAgICAgICAgdGhpcy5pc0xpc3RlbmluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIGFzeW5jIHRvZ2dsZV9zdHQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzTGlzdGVuaW5nKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnN0b3Bfc3R0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0X3N0dCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgdHJhbnNsYXRlRG9jdW1lbnQoeyBzb3VyY2VMYW5ndWFnZSwgdGFyZ2V0TGFuZ3VhZ2UsIHVwbG9hZGVkRmlsZSB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdzb3VyY2VMYW5ndWFnZScsIHNvdXJjZUxhbmd1YWdlIHx8ICdlbmdsaXNoJyk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3RhcmdldExhbmd1YWdlJywgdGFyZ2V0TGFuZ3VhZ2UgfHwgJ2hpbmRpJyk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3Byb2plY3RGaWxlcycsIHVwbG9hZGVkRmlsZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vcmV2YXBpLnJldmVyaWVpbmMuY29tL3RyYW5zbGF0ZV9kb2NfaW1wb3J0Jywge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFAtSUQnOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQUE5BTUUnOiAnbm10JyxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUEktS0VZJzogdGhpcy5hcGlLZXlcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vayAmJiBkYXRhLnByb2plY3RJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrU3RhdHVzKGRhdGEucHJvamVjdElkLCB0YXJnZXRMYW5ndWFnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgaW4gdHJhbnNsYXRpb24gcHJvY2VzcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmFuc2xhdGlvbiBmYWlsZWQ6ICcgKyBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNoZWNrU3RhdHVzKGRvY0lkLCB0YXJnZXRMYW5ndWFnZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcG9sbFN0YXR1cyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwczovL3JldmFwaS5yZXZlcmllaW5jLmNvbS90cmFuc2xhdGVfZG9jX3N0YXR1cz9kb2NfaWQ9JHtkb2NJZH1gLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFAtSUQnOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSRVYtQVBQTkFNRSc6ICdubXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSRVYtQVBJLUtFWSc6IHRoaXMuYXBpS2V5XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXNEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXNEYXRhLnN1Y2Nlc3MgJiYgc3RhdHVzRGF0YS5tZXNzYWdlID09PSAnY29tcGxldGVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0aGlzLmRvd25sb2FkVHJhbnNsYXRlZEZpbGUoZG9jSWQsIHRhcmdldExhbmd1YWdlKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHBvbGxTdGF0dXMsIDIwMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignRXJyb3IgY2hlY2tpbmcgc3RhdHVzOiAnICsgZXJyb3IubWVzc2FnZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBwb2xsU3RhdHVzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGRvd25sb2FkVHJhbnNsYXRlZEZpbGUoZG9jSWQsIHRhcmdldExhbmd1YWdlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL3JldmFwaS5yZXZlcmllaW5jLmNvbS90cmFuc2xhdGVfZG9jX2V4cG9ydCcsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBQLUlEJzogdGhpcy5hcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFBOQU1FJzogJ25tdCcsXG4gICAgICAgICAgICAgICAgICAgICdSRVYtQVBJLUtFWSc6IHRoaXMuYXBpS2V5XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHVuaXRJZDogZG9jSWQsIHRhcmdldExhbmd1YWdlczogW3RhcmdldExhbmd1YWdlXSB9KVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZURhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMocmVzcG9uc2VEYXRhLmRhdGEudGFyZ2V0VVJMUykuZm9yRWFjaChsYW5ndWFnZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGxhbmd1YWdlcykuZm9yRWFjaChmaWxlVVJMID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGZpbGVVUkwsICdfYmxhbmsnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdUcmFuc2xhdGlvbiBjb21wbGV0ZSEgRmlsZSBpcyByZWFkeSBmb3IgZG93bmxvYWQuJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBkb3dubG9hZGluZyB0cmFuc2xhdGlvbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb3dubG9hZCBmYWlsZWQ6ICcgKyBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHVwbG9hZERvY3VtZW50KHsgZmlsZSwgZmlsZV90eXBlLCBsYW5ndWFnZXMsIG9jcl90eXBlIH0pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIHNlbGVjdCBhIGZpbGUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFmaWxlX3R5cGUgfHwgKGZpbGVfdHlwZSAhPT0gJ3BkZicgJiYgZmlsZV90eXBlICE9PSAnaW1nJykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGZpbGVfdHlwZS4gTXVzdCBiZSAncGRmJyBvciAnaW1nJ1wiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFsYW5ndWFnZXMpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJMYW5ndWFnZXMgcGFyYW1ldGVyIGlzIHJlcXVpcmVkXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIW9jcl90eXBlIHx8IChvY3JfdHlwZSAhPT0gJ2xheW91dF9vY3InICYmIG9jcl90eXBlICE9PSAnb25seV9vY3InKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgb2NyX3R5cGUuIE11c3QgYmUgJ2xheW91dF9vY3InIG9yICdvbmx5X29jcidcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmaWxlX3R5cGUgPT09ICdpbWcnICYmIG9jcl90eXBlID09PSAnbGF5b3V0X29jcicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xheW91dCBPQ1IgaXMgbm90IHN1cHBvcnRlZCBmb3IgaW1hZ2VzLiBQbGVhc2Ugc2VsZWN0IE9ubHkgT0NSLicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgZmlsZSk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGVfdHlwZScsIGZpbGVfdHlwZSk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2xhbmd1YWdlcycsIGxhbmd1YWdlcyk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ29jcl90eXBlJywgb2NyX3R5cGUpO1xuXG4gICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLmJhc2VVcmwgKyAnL3Byb2Nlc3NfZG9jJywge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFAtSUQnOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQSS1LRVknOiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFBOQU1FJzogJ29jcidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG9jcl90eXBlID09PSAnbGF5b3V0X29jcicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuYmxvYigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGFzeW5jIHVwbG9hZEF1ZGlvKHsgZmlsZSB9KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIWZpbGUpIHRocm93IG5ldyBFcnJvcignUGxlYXNlIHNlbGVjdCBhbiBhdWRpbyBmaWxlJyk7XG5cbiAgICAgICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2F1ZGlvX2ZpbGUnLCBmaWxlKTtcblxuICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godGhpcy5iYXNlVXJsICsgJy91cGxvYWQnLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQSS1LRVknOiB0aGlzLmFwaUtleSxcbiAgICAgICAgICAgICAgICAgICAgJ1JFVi1BUFAtSUQnOiB0aGlzLmFwcElkLFxuICAgICAgICAgICAgICAgICAgICAnUkVWLUFQUE5BTUUnOiAnc2xpZCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHRocm93IG5ldyBFcnJvcihyZXN1bHQuY2F1c2UpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRyYW5zY3JpcHRpb25JZDogcmVzdWx0LmlkLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlOiByZXN1bHQubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgY29uZmlkZW5jZTogcmVzdWx0LmNvbmZpZGVuY2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBSZXZlcmllQ2xpZW50IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImltcG9ydCBSZXZlcmllQ2xpZW50IGZyb20gXCJAcmV2ZXJpZWl0L3JldmVyaWUtY2xpZW50XCI7XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInVwbG9hZEJ0blwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVJbnB1dCcpO1xyXG4gICAgY29uc3QgZmlsZSA9IGZpbGVJbnB1dC5maWxlc1swXTtcclxuICAgIGNvbnN0IGxhbmd1YWdlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhbmd1YWdlU2VsZWN0Jyk7XHJcbiAgICBjb25zdCBzZWxlY3RlZExhbmd1YWdlcyA9IEFycmF5LmZyb20obGFuZ3VhZ2VTZWxlY3Quc2VsZWN0ZWRPcHRpb25zKVxyXG4gICAgICAgIC5tYXAob3B0aW9uID0+IG9wdGlvbi52YWx1ZSlcclxuICAgICAgICAuam9pbignLCcpO1xyXG5cclxuICAgIGNvbnN0IG9jclR5cGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb2NyVHlwZVNlbGVjdCcpLnZhbHVlO1xyXG4gICAgY29uc3QgcmVzcG9uc2VUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3BvbnNlJyk7XHJcbiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7XHJcblxyXG4gICAgY29uc3QgcmV2ZXJpZUNsaWVudCA9IG5ldyBSZXZlcmllQ2xpZW50KHtcclxuICAgICAgICBhcGlLZXk6IFwiZGExYzEyYWNmZWU4YTIwNGNmNmExMzVlYzAxNTdkNmFkYWZmZDQ3OFwiLFxyXG4gICAgICAgIGFwcElkOiBcImNvbS5ucG1wYWNrYWdlXCIsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoIWZpbGUpIHtcclxuICAgICAgICBhbGVydCgnUGxlYXNlIHNlbGVjdCBhIGZpbGUnKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsZVR5cGUgPSBmaWxlLnR5cGUgPT09ICdhcHBsaWNhdGlvbi9wZGYnID8gJ3BkZicgOiAnaW1nJztcclxuICAgIGlmIChmaWxlVHlwZSA9PT0gJ2ltZycgJiYgb2NyVHlwZVNlbGVjdCA9PT0gJ2xheW91dF9vY3InKSB7XHJcbiAgICAgICAgYWxlcnQoJ0xheW91dCBPQ1IgaXMgbm90IHN1cHBvcnRlZCBmb3IgaW1hZ2VzLiBQbGVhc2Ugc2VsZWN0IE9ubHkgT0NSLicpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICByZXNwb25zZVRleHQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgbG9hZGVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblxyXG4gICAgdHJ5IHtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJldmVyaWVDbGllbnQudXBsb2FkRG9jdW1lbnQoe1xyXG4gICAgICAgICAgICBmaWxlOiBmaWxlLFxyXG4gICAgICAgICAgICBmaWxlX3R5cGU6IGZpbGVUeXBlLFxyXG4gICAgICAgICAgICBsYW5ndWFnZXM6IHNlbGVjdGVkTGFuZ3VhZ2VzLFxyXG4gICAgICAgICAgICBvY3JfdHlwZTogb2NyVHlwZVNlbGVjdFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAob2NyVHlwZVNlbGVjdCA9PT0gJ2xheW91dF9vY3InKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICAgIGEuaHJlZiA9IHVybDtcclxuICAgICAgICAgICAgYS5kb3dubG9hZCA9ICdvdXRwdXQuZG9jeCc7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XHJcbiAgICAgICAgICAgIGEuY2xpY2soKTtcclxuICAgICAgICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcclxuICAgICAgICAgICAgcmVzcG9uc2VUZXh0LnRleHRDb250ZW50ID0gXCJGaWxlIGRvd25sb2FkZWQgc3VjY2Vzc2Z1bGx5LlwiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlVGV4dC50ZXh0Q29udGVudCA9IHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXNwb25zZVRleHQudGV4dENvbnRlbnQgPSAnRXJyb3Igb2NjdXJyZWQgd2hpbGUgcHJvY2Vzc2luZyc7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IC8vIEhpZGUgbG9hZGVyXHJcbiAgICB9XHJcbn0pO1xyXG4iXSwibmFtZXMiOlsiaXNFZGl0YWJsZSIsImVsZW1lbnQiLCJ0YWdOYW1lIiwiaXNDb250ZW50RWRpdGFibGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiY29uc3RydWN0b3IiLCJwYXJhbWV0ZXJzIiwidGhpcyIsImFwaUtleSIsImFwcElkIiwiYmFzZVVybCIsImlzTGlzdGVuaW5nIiwic2NyaXB0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwiYm9keSIsImFwcGVuZENoaWxkIiwidHJhbnNsaXRlcmF0ZSIsInRleHQiLCJzcmNfbGFuZyIsInRndF9sYW5nIiwiZG9tYWluIiwiRXJyb3IiLCJyZXNwIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiSlNPTiIsInN0cmluZ2lmeSIsImRhdGEiLCJpc0J1bGsiLCJpZ25vcmVUYWdnZWRFbnRpdGllcyIsImpzb24iLCJyZXNwb25zZUxpc3QiLCJsZW5ndGgiLCJvdXRTdHJpbmciLCJlcnJvciIsIm1lc3NhZ2UiLCJhbmFseXplX3RleHQiLCJ0cmFuc2xhdGlvbl9kb21haW4iLCJtb2RlcmF0aW9uX3R5cGVzIiwidXJsIiwicmVzcG9uc2UiLCJyZXN1bHRzIiwiaWRlbnRpZnlfbGFuZ3VhZ2VfYnlfdGV4dCIsIk1hdGgiLCJwb3ciLCJmbG9vciIsInNxcnQiLCJ0cmFuc2xhdGUiLCJzdHRfYmF0Y2giLCJhdWRpb0ZpbGUiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwiZGlzcGxheV90ZXh0IiwidGV4dF90b19zcGVlY2giLCJzcGVha2VyIiwic3BlZWQiLCJwaXRjaCIsImZvcm1hdCIsImluY2x1ZGVzIiwicmVxdWVzdERhdGEiLCJwYXJzZUZsb2F0IiwiYmxvYiIsImluaXRfc3R0Iiwic2lsZW5jZSIsImNvbnRpbnVvdXMiLCJsb2dnaW5nIiwidGltZW91dCIsImNhbGxiYWNrIiwid2luZG93Iiwic3R0X3N0cmVhbSIsImluaXRTVFQiLCJhcGlrZXkiLCJsYW5ndWFnZSIsImV2ZW50SGFuZGxlciIsImV2ZW50IiwibGFuZyIsInN0dF90ZXh0IiwiZXhlY0NvbW1hbmQiLCJzdHRfZXZlbnQiLCJ2b2ljZVRleHQiLCJlcnJvckhhbmRsZXIiLCJjb25zb2xlIiwibG9nIiwic3RhcnRfc3R0Iiwic3RhcnRTVFQiLCJzdG9wX3N0dCIsInN0b3BTVFQiLCJ0b2dnbGVfc3R0IiwidHJhbnNsYXRlRG9jdW1lbnQiLCJzb3VyY2VMYW5ndWFnZSIsInRhcmdldExhbmd1YWdlIiwidXBsb2FkZWRGaWxlIiwib2siLCJwcm9qZWN0SWQiLCJjaGVja1N0YXR1cyIsImRvY0lkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb2xsU3RhdHVzIiwiYXN5bmMiLCJzdGF0dXNEYXRhIiwic3VjY2VzcyIsImRvd25sb2FkVHJhbnNsYXRlZEZpbGUiLCJzZXRUaW1lb3V0IiwidW5pdElkIiwidGFyZ2V0TGFuZ3VhZ2VzIiwicmVzcG9uc2VEYXRhIiwiT2JqZWN0IiwidmFsdWVzIiwidGFyZ2V0VVJMUyIsImZvckVhY2giLCJsYW5ndWFnZXMiLCJmaWxlVVJMIiwib3BlbiIsInVwbG9hZERvY3VtZW50IiwiZmlsZSIsImZpbGVfdHlwZSIsIm9jcl90eXBlIiwidXBsb2FkQXVkaW8iLCJyZXN1bHQiLCJjYXVzZSIsInRyYW5zY3JpcHRpb25JZCIsImlkIiwiY29uZmlkZW5jZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVzX18iLCJuIiwiZ2V0dGVyIiwiX19lc01vZHVsZSIsImQiLCJhIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZ2V0RWxlbWVudEJ5SWQiLCJhZGRFdmVudExpc3RlbmVyIiwiZmlsZXMiLCJsYW5ndWFnZVNlbGVjdCIsInNlbGVjdGVkTGFuZ3VhZ2VzIiwiQXJyYXkiLCJmcm9tIiwic2VsZWN0ZWRPcHRpb25zIiwibWFwIiwib3B0aW9uIiwidmFsdWUiLCJqb2luIiwib2NyVHlwZVNlbGVjdCIsInJlc3BvbnNlVGV4dCIsImxvYWRlciIsInJldmVyaWVDbGllbnQiLCJhbGVydCIsImZpbGVUeXBlIiwidHlwZSIsInRleHRDb250ZW50Iiwic3R5bGUiLCJkaXNwbGF5IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiaHJlZiIsImRvd25sb2FkIiwiY2xpY2siLCJyZXZva2VPYmplY3RVUkwiXSwic291cmNlUm9vdCI6IiJ9